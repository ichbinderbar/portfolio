<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Payment Confirmation | Juan Idrovo</title><link rel="icon shortcut" type="image/png" href="/favicon.887424ff.png"><meta name="theme-color" content="#0d9488"><style>*{box-sizing:border-box;margin:0;padding:0}body{min-height:100vh;color:#fff;background:linear-gradient(135deg,#0d9488 0%,#0f172a 100%);justify-content:center;align-items:center;padding:2rem;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,sans-serif;display:flex}.container{text-align:center;max-width:500px}.spinner{width:50px;height:50px;border:4px solid #ffffff4d;border-top-color:#fff;border-radius:50%;margin:0 auto 2rem;animation:1s linear infinite spin}@keyframes spin{to{transform:rotate(360deg)}}h1{margin-bottom:1rem;font-size:1.5rem}p{opacity:.9;margin-bottom:.5rem}.error{background:#ef444433;border:1px solid #ef4444;border-radius:8px;margin-top:1rem;padding:1.5rem}.success{background:#22c55e33;border:1px solid #22c55e;border-radius:8px;margin-top:1rem;padding:1.5rem}.success h2{color:#22c55e;margin-bottom:.5rem}.error h2{color:#ef4444;margin-bottom:.5rem}.btn{color:#0f172a;background:#fff;border-radius:4px;margin-top:1.5rem;padding:.75rem 2rem;font-weight:600;text-decoration:none;transition:transform .2s;display:inline-block}.btn:hover{transform:translateY(-2px)}.details{opacity:.8;margin-top:1rem;font-size:.9rem}#processing,#result{display:none}#processing.active,#result.active{display:block}</style></head><body> <div class="container"> <div id="processing" class="active"> <div class="spinner"></div> <h1 id="processing-title">Processing your payment...</h1> <p id="processing-subtitle">Please don't close this window</p> </div> <div id="result"></div> </div> <script>const PAYPHONE_CONFIRM_URL="https://pay.payphonetodoesposible.com/api/button/V2/Confirm",params=new URLSearchParams(window.location.search),paymentId=params.get("id"),clientTransactionId=params.get("clientTransactionId"),token=sessionStorage.getItem("payphone_token"),storedLang=localStorage.getItem("i18nextLng"),lang=storedLang||(navigator.language.startsWith("es")?"es":"en"),texts={en:{processing:"Processing your payment...",processingSubtitle:"Please don't close this window",successTitle:"Payment Successful!",successMessage:"Thank you for your payment.",errorTitle:"Payment Failed",errorSession:"Payment session expired. Please try again.",errorParams:"Invalid payment parameters.",errorGeneric:"An error occurred processing your payment.",backButton:"Back to Portfolio",amount:"Amount",transaction:"Transaction ID",card:"Card"},es:{processing:"Procesando tu pago...",processingSubtitle:"Por favor no cierres esta ventana",successTitle:"Pago Exitoso!",successMessage:"Gracias por tu pago.",errorTitle:"Pago Fallido",errorSession:"Sesión de pago expirada. Por favor intenta de nuevo.",errorParams:"Parámetros de pago inválidos.",errorGeneric:"Ocurrió un error procesando tu pago.",backButton:"Volver al Portafolio",amount:"Monto",transaction:"ID de Transacción",card:"Tarjeta"}},t=texts[lang];function showResult(e,n,o,s=null){document.getElementById("processing").classList.remove("active");const a=document.getElementById("result");a.classList.add("active");const r=document.createElement("div");r.className=e?"success":"error";const i=document.createElement("h2");i.textContent=n,r.appendChild(i);const c=document.createElement("p");if(c.textContent=o,r.appendChild(c),s){const e=document.createElement("div");e.className="details";const n=e=>String(e).replace(/[<>&"']/g,""),o=[`${t.amount}: $${n(s.amount)}`,`${t.transaction}: ${n(s.transactionId)}`];s.lastDigits&&o.push(`${t.card}: **** ${n(s.lastDigits)}`),e.innerHTML=o.join("<br>"),r.appendChild(e)}a.appendChild(r);const l=document.createElement("a");l.href="/",l.className="btn",l.textContent=t.backButton,a.appendChild(l)}async function confirmPayment(){if(token)if(paymentId&&clientTransactionId)try{const e=await fetch(PAYPHONE_CONFIRM_URL,{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"},body:JSON.stringify({id:parseInt(paymentId,10),clientTxId:clientTransactionId})});if(!e.ok)throw new Error(`HTTP ${e.status}`);const n=await e.json();sessionStorage.removeItem("payphone_token"),sessionStorage.removeItem("payphone_amount"),"Approved"===n.transactionStatus||3===n.statusCode?showResult(!0,t.successTitle,t.successMessage,{amount:(n.amount/100).toFixed(2),transactionId:n.transactionId,lastDigits:n.lastDigits}):showResult(!1,t.errorTitle,n.message||t.errorGeneric)}catch(e){console.error("Confirm error:",e),showResult(!1,t.errorTitle,t.errorGeneric)}else showResult(!1,t.errorTitle,t.errorParams);else showResult(!1,t.errorTitle,t.errorSession)}document.getElementById("processing-title").textContent=t.processing,document.getElementById("processing-subtitle").textContent=t.processingSubtitle,confirmPayment();</script> </body></html>